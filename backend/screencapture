import pyautogui
import keyboard
from pynput import mouse
import pymongo
from bson.binary import Binary

# Connect to MongoDB
client = pymongo.MongoClient("mongodb://localhost:27017/")
db = client["screenshot_database"]
collection = db["screenshots"]

# Function to save screenshot to MongoDB
def save_screenshot_to_mongodb(x, y, image_data):
    screenshot_data = {
        "x": x,
        "y": y,
        "image_data": Binary(image_data)
    }
    collection.insert_one(screenshot_data)

# Example function to process keyboard events
def on_keyboard_event(event):
    if event.name == 'esc':
        # Stop the mouse listener
        mouse_listener.stop()
        # Stop the keyboard listener
        keyboard.unhook_all()
        print("Program stopped")
        return False

# Example function to process mouse events
def on_mouse_event(x, y, button, pressed):
    if pressed:
        # Take a screenshot when a mouse button is pressed
        screenshot = pyautogui.screenshot()
        # Convert the screenshot to bytes
        image_data = screenshot.tobytes()
        # Save the screenshot to MongoDB
        save_screenshot_to_mongodb(x, y, image_data)
        print(f"Screenshot saved to MongoDB: ({x}, {y})")

# Register keyboard event listener
keyboard.on_release(on_keyboard_event)

# Register mouse event listener
# Note: This is a placeholder and may not work as expected
# You may need to use a dedicated library or tool to capture mouse events
mouse_listener = mouse.Listener(on_click=on_mouse_event)
mouse_listener.start()

# Keep the script running
keyboard.wait("esc")
